<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notes API</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        min-height: 100vh;
        font-family: system-ui, sans-serif;
        background: #111;
        color: #fff;
        padding: 2rem;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      h1 {
        margin-bottom: 2rem;
      }
      h3 {
        margin-bottom: 1rem;
        color: #fff;
      }
      .add-form {
        margin: 2rem 0;
        padding: 1.5rem;
        background: #1a1a1a;
        border-radius: 8px;
      }
      textarea {
        width: 100%;
        padding: 1rem;
        border: none;
        border-radius: 8px;
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
        font-size: 1rem;
        background: #222;
        color: #fff;
      }
      textarea::placeholder {
        color: #666;
      }
      textarea:focus {
        outline: 2px solid #3b82f6;
      }
      .notes-list {
        list-style: none;
      }
      .note-item {
        padding: 1rem;
        border-bottom: 1px solid #222;
        transition: background 0.2s;
      }
      .note-item:hover {
        background: #1a1a1a;
      }
      .note-content {
        margin-bottom: 0.5rem;
        white-space: pre-wrap;
      }
      .note-date {
        color: #666;
        font-size: 0.9rem;
      }
      button {
        font-size: 1rem;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        background: #3b82f6;
        color: #fff;
        cursor: pointer;
        transition: background 0.2s;
        margin-top: 1rem;
      }
      button:hover {
        background: #2563eb;
      }
      button:active {
        transform: scale(0.98);
      }
      .empty {
        color: #666;
        font-style: italic;
        padding: 1rem 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Notes</h1>

      <div class="add-form">
        <h3>Add a note</h3>
        <form id="noteForm">
          <textarea name="content" placeholder="Write your note..." required></textarea>
          <button type="submit">Add Note</button>
        </form>
      </div>

      <h3>All Notes</h3>
      <ul class="notes-list" id="notesList">
        <li>Loading...</li>
      </ul>
    </div>

    <script>
      async function loadNotes() {
        const res = await fetch("/notes");
        const notes = await res.json();
        const list = document.getElementById("notesList");

        if (notes.length === 0) {
          list.innerHTML = '<li class="empty">No notes yet</li>';
          return;
        }

        list.innerHTML = notes
          .map(
            (note) => `
          <li class="note-item">
            <div class="note-content">${escapeHtml(note.content)}</div>
            <div class="note-date">${new Date(note.created_at).toLocaleString()}</div>
          </li>
        `
          )
          .join("");
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      document.getElementById("noteForm").onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const content = formData.get("content");

        await fetch("/notes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content }),
        });

        e.target.reset();
        loadNotes();
      };

      loadNotes();
    </script>
  </body>
</html>
